#!/bin/bash

# Get the parent directory of this script
SCRIPT_DIR="$(dirname $(realpath "$0"))"

# Deactivate the current environment (if any)
deactivate 2> /dev/null

# Create env directory if it doesn't already exist
mkdir -p envs

# Delete any pre-existing environments
rm -rf "${SCRIPT_DIR}/envs/original" \
    "${SCRIPT_DIR}/envs/modified" \
    "${SCRIPT_DIR}/envs/ct_data"

# Create new environments
python3 -m venv "${SCRIPT_DIR}/envs/original"
python3 -m venv "${SCRIPT_DIR}/envs/modified"

# Install dependencies in 'original' environment
source "${SCRIPT_DIR}/envs/original/bin/activate"
pip3 install --upgrade pip
pip3 install -r "${SCRIPT_DIR}/requirements_original.txt"
deactivate

# Install dependencies in 'modified' environment
source "${SCRIPT_DIR}/envs/modified/bin/activate"
pip3 install --upgrade pip
pip3 install -r "${SCRIPT_DIR}/requirements_modified.txt"
deactivate

# Download required CAMeL Tools data
source "${SCRIPT_DIR}/envs/original/bin/activate"
mkdir -p "${SCRIPT_DIR}/envs/ct_data"
export CAMELTOOLS_DATA="${SCRIPT_DIR}/envs/ct_data"
camel_data -u
camel_data -i disambig-bert-unfactored-msa
