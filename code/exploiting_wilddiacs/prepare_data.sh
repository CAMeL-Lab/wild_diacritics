#!/bin/bash

# Get the parent directory of this script
ROOT_DIR="$(dirname "$(realpath "$0")")"

# Get data directory
DATA_DIR="$(dirname "$(dirname "${ROOT_DIR}")")/data"

# Deactivate the current environment (if any)
deactivate 2> /dev/null

# Activate the original CAMeL Tools environment
source "${ROOT_DIR}/envs/original/bin/activate"

# Create data directories if they don't already exist
W2M_DEV_OUTPUT_DIR="${ROOT_DIR}/data/wild2max/dev"
W2M_TEST_OUTPUT_DIR="${ROOT_DIR}/data/wild2max/test"
WNM_OUTPUT_DIR="${ROOT_DIR}/data/wikinewsmax"

mkdir -p "${W2M_DEV_OUTPUT_DIR}"
mkdir -p "${W2M_TEST_OUTPUT_DIR}"
mkdir -p "${WNM_OUTPUT_DIR}"

# Prepare datasets
W2M_DEV_DATA_PATH="${DATA_DIR}/Wild2Max_dev.tsv"
W2M_TEST_DATA_PATH="${DATA_DIR}/Wild2Max_test.tsv"
WNM_DATA_PATH="${DATA_DIR}/WikiNewsMax.tsv"

python3 "${ROOT_DIR}/prepare_wild2max.py" \
    "${W2M_DEV_DATA_PATH}" "${W2M_DEV_OUTPUT_DIR}"

python3 "${ROOT_DIR}/prepare_wild2max.py" \
    "${W2M_TEST_DATA_PATH}" "${W2M_TEST_OUTPUT_DIR}"

python3 "${ROOT_DIR}/prepare_wikinewsmax.py" \
    "${WNM_DATA_PATH}" "${WNM_OUTPUT_DIR}"

# Deactivate the original CAMeL Tools environment
deactivate
